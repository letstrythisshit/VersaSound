# Default configuration for VersaSound ComfyUI Extension

# Visual Encoder Configuration
visual_encoder:
  model_name: "versatile"  # versatile, speech_optimized, foley_optimized
  backbone_name: "videomae_base"  # videomae_base, videomae_large, internvideo
  backbone_dim: 768
  output_dim: 768
  num_heads: 12
  num_temporal_layers: 4
  freeze_backbone: true

  motion_encoder:
    type: "learned"  # learned, optical_flow
    hidden_dim: 256
    num_layers: 3

  audio_cue_extractor:
    enabled: true
    features:
      - "intensity_envelope"
      - "contact_detection"
      - "velocity_estimation"
      - "periodic_motion"
    hidden_dim: 512

# Audio Generator Configuration
audio_generator:
  model_name: "audioldm2"  # audioldm2, stable_audio, audiocraft
  visual_dim: 768
  adapter_layers: 4
  use_lora: false
  lora_rank: 16

  generation:
    default_sample_rate: 48000
    default_duration: null  # null = use video duration
    num_inference_steps: 50
    guidance_scale: 7.5

  temporal_controller:
    enabled: true
    output_types:
      - "intensity_envelope"
      - "event_timings"
      - "rhythm"
    hidden_dim: 256

# Temporal Alignment Configuration
temporal_alignment:
  enabled: true
  sync_method: "learned"  # learned, dtw, cross_correlation
  alignment_threshold: 0.1  # 100ms
  allow_time_stretch: true
  max_stretch_ratio: 0.1  # 10% max stretch

  event_detector:
    threshold: 0.5
    min_event_duration: 0.05  # 50ms

# Device and Performance
device:
  auto_detect: true
  preferred_device: "cuda"  # cuda, mps, cpu
  precision: "fp16"  # fp32, fp16, bf16
  use_autocast: true

memory:
  clear_cache_after_generation: true
  gradient_checkpointing: false  # for inference, keep false
  max_batch_size: 8

# Video Processing
video_processing:
  target_fps: 24.0
  target_size: [224, 224]  # [height, width]
  max_frames: 240  # 10 seconds at 24fps
  normalization:
    mean: [0.485, 0.456, 0.406]
    std: [0.229, 0.224, 0.225]

# Audio Processing
audio_processing:
  target_sample_rate: 48000
  mono: false
  max_duration: 10.0  # seconds
  normalization:
    enabled: true
    method: "peak"  # peak, rms, lufs
    target_level: -3.0  # dB

# Model Checkpoints
checkpoints:
  visual_encoder: "checkpoints/visual_encoder.safetensors"
  audio_generator: "checkpoints/audio_generator.safetensors"
  temporal_aligner: "checkpoints/temporal_aligner.safetensors"
  auto_download: true
  download_url_base: "https://huggingface.co/versasound"

# Logging
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  log_to_file: false
  log_file: "versasound.log"
